{"data":"aW1wb3J0IHsgCiAgY29sbGVjdGlvbiwgCiAgZG9jLCAKICBnZXREb2NzLCAKICBxdWVyeSwgCiAgd2hlcmUsIAogIGFkZERvYywgCiAgdXBkYXRlRG9jLCAKICBzZXJ2ZXJUaW1lc3RhbXAsCiAgVGltZXN0YW1wLAogIG9yZGVyQnksCiAgcnVuVHJhbnNhY3Rpb24KfSBmcm9tICdmaXJlYmFzZS9maXJlc3RvcmUnOwppbXBvcnQgeyBkYiB9IGZyb20gJy4vZmlyZWJhc2UnOwppbXBvcnQgeyBTYXZpbmdzQWNjb3VudCwgU2F2aW5nc1RyYW5zYWN0aW9uIH0gZnJvbSAnLi4vdHlwZXMnOwoKY29uc3QgU0FWSU5HU19DT0xMRUNUSU9OID0gJ3NhdmluZ3NfYWNjb3VudHMnOwpjb25zdCBUUkFOU0FDVElPTlNfQ09MTEVDVElPTiA9ICdzYXZpbmdzX3RyYW5zYWN0aW9ucyc7CgpleHBvcnQgY29uc3QgZ2V0U2F2aW5nc0FjY291bnQgPSBhc3luYyAoY3VzdG9tZXJJZDogc3RyaW5nKTogUHJvbWlzZTxTYXZpbmdzQWNjb3VudCB8IG51bGw+ID0+IHsKICBjb25zdCBxID0gcXVlcnkoY29sbGVjdGlvbihkYiwgU0FWSU5HU19DT0xMRUNUSU9OKSwgd2hlcmUoJ2N1c3RvbWVySWQnLCAnPT0nLCBjdXN0b21lcklkKSk7CiAgY29uc3QgcXVlcnlTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSk7CiAgCiAgaWYgKHF1ZXJ5U25hcHNob3QuZW1wdHkpIHsKICAgIHJldHVybiBudWxsOwogIH0KICAKICBjb25zdCBkb2MgPSBxdWVyeVNuYXBzaG90LmRvY3NbMF07CiAgY29uc3QgZGF0YSA9IGRvYy5kYXRhKCk7CiAgCiAgcmV0dXJuIHsKICAgIGlkOiBkb2MuaWQsCiAgICAuLi5kYXRhLAogICAgY3JlYXRlZEF0OiBkYXRhLmNyZWF0ZWRBdD8udG9EYXRlKCksCiAgICB1cGRhdGVkQXQ6IGRhdGEudXBkYXRlZEF0Py50b0RhdGUoKSwKICAgIGxhc3RXYWppYlBheW1lbnQ6IGRhdGEubGFzdFdhamliUGF5bWVudD8udG9EYXRlKCksCiAgfSBhcyBTYXZpbmdzQWNjb3VudDsKfTsKCmV4cG9ydCBjb25zdCBjcmVhdGVTYXZpbmdzQWNjb3VudCA9IGFzeW5jIChjdXN0b21lcklkOiBzdHJpbmcpOiBQcm9taXNlPFNhdmluZ3NBY2NvdW50PiA9PiB7CiAgY29uc3QgbmV3QWNjb3VudCA9IHsKICAgIGN1c3RvbWVySWQsCiAgICBiYWxhbmNlV2FqaWI6IDAsCiAgICBiYWxhbmNlU3VrYXJlbGE6IDAsCiAgICBiYWxhbmNlUG9rb2s6IDAsCiAgICBjcmVhdGVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpLAogICAgdXBkYXRlZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSwKICB9OwogIAogIGNvbnN0IGRvY1JlZiA9IGF3YWl0IGFkZERvYyhjb2xsZWN0aW9uKGRiLCBTQVZJTkdTX0NPTExFQ1RJT04pLCBuZXdBY2NvdW50KTsKICAKICByZXR1cm4gewogICAgaWQ6IGRvY1JlZi5pZCwKICAgIGN1c3RvbWVySWQsCiAgICBiYWxhbmNlV2FqaWI6IDAsCiAgICBiYWxhbmNlU3VrYXJlbGE6IDAsCiAgICBiYWxhbmNlUG9rb2s6IDAsCiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksCiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksCiAgfTsKfTsKCmV4cG9ydCBjb25zdCBwcm9jZXNzVHJhbnNhY3Rpb24gPSBhc3luYyAoCiAgY3VzdG9tZXJJZDogc3RyaW5nLCAKICB0cmFuc2FjdGlvbkRhdGE6IE9taXQ8U2F2aW5nc1RyYW5zYWN0aW9uLCAnaWQnIHwgJ3NhdmluZ3NBY2NvdW50SWQnIHwgJ2RhdGUnPgopOiBQcm9taXNlPHZvaWQ+ID0+IHsKICB0cnkgewogICAgYXdhaXQgcnVuVHJhbnNhY3Rpb24oZGIsIGFzeW5jICh0cmFuc2FjdGlvbikgPT4gewogICAgICAvLyAxLiBHZXQgb3IgY3JlYXRlIHNhdmluZ3MgYWNjb3VudAogICAgICBjb25zdCBxID0gcXVlcnkoY29sbGVjdGlvbihkYiwgU0FWSU5HU19DT0xMRUNUSU9OKSwgd2hlcmUoJ2N1c3RvbWVySWQnLCAnPT0nLCBjdXN0b21lcklkKSk7CiAgICAgIGNvbnN0IHF1ZXJ5U25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpOwogICAgICAKICAgICAgbGV0IGFjY291bnRSZWY7CiAgICAgIGxldCBjdXJyZW50QWNjb3VudDogYW55OwogICAgICAKICAgICAgaWYgKHF1ZXJ5U25hcHNob3QuZW1wdHkpIHsKICAgICAgICAvLyBDcmVhdGUgbmV3IGFjY291bnQgcmVmZXJlbmNlCiAgICAgICAgYWNjb3VudFJlZiA9IGRvYyhjb2xsZWN0aW9uKGRiLCBTQVZJTkdTX0NPTExFQ1RJT04pKTsKICAgICAgICBjdXJyZW50QWNjb3VudCA9IHsKICAgICAgICAgIGN1c3RvbWVySWQsCiAgICAgICAgICBiYWxhbmNlV2FqaWI6IDAsCiAgICAgICAgICBiYWxhbmNlU3VrYXJlbGE6IDAsCiAgICAgICAgICBiYWxhbmNlUG9rb2s6IDAsCiAgICAgICAgICBjcmVhdGVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpLAogICAgICAgICAgdXBkYXRlZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSwKICAgICAgICB9OwogICAgICAgIHRyYW5zYWN0aW9uLnNldChhY2NvdW50UmVmLCBjdXJyZW50QWNjb3VudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYWNjb3VudFJlZiA9IHF1ZXJ5U25hcHNob3QuZG9jc1swXS5yZWY7CiAgICAgICAgY3VycmVudEFjY291bnQgPSBxdWVyeVNuYXBzaG90LmRvY3NbMF0uZGF0YSgpOwogICAgICB9CiAgICAgIAogICAgICAvLyAyLiBDYWxjdWxhdGUgbmV3IGJhbGFuY2UKICAgICAgY29uc3QgYW1vdW50ID0gTnVtYmVyKHRyYW5zYWN0aW9uRGF0YS5hbW91bnQpOwogICAgICBjb25zdCBpc0RlcG9zaXQgPSB0cmFuc2FjdGlvbkRhdGEudHlwZSA9PT0gJ2RlcG9zaXQnOwogICAgICBjb25zdCBjaGFuZ2UgPSBpc0RlcG9zaXQgPyBhbW91bnQgOiAtYW1vdW50OwogICAgICAKICAgICAgbGV0IG5ld0JhbGFuY2VXYWppYiA9IGN1cnJlbnRBY2NvdW50LmJhbGFuY2VXYWppYiB8fCAwOwogICAgICBsZXQgbmV3QmFsYW5jZVN1a2FyZWxhID0gY3VycmVudEFjY291bnQuYmFsYW5jZVN1a2FyZWxhIHx8IDA7CiAgICAgIGxldCBuZXdCYWxhbmNlUG9rb2sgPSBjdXJyZW50QWNjb3VudC5iYWxhbmNlUG9rb2sgfHwgMDsKICAgICAgCiAgICAgIGlmICh0cmFuc2FjdGlvbkRhdGEuY2F0ZWdvcnkgPT09ICd3YWppYicpIHsKICAgICAgICBuZXdCYWxhbmNlV2FqaWIgKz0gY2hhbmdlOwogICAgICB9IGVsc2UgaWYgKHRyYW5zYWN0aW9uRGF0YS5jYXRlZ29yeSA9PT0gJ3N1a2FyZWxhJykgewogICAgICAgIG5ld0JhbGFuY2VTdWthcmVsYSArPSBjaGFuZ2U7CiAgICAgIH0gZWxzZSBpZiAodHJhbnNhY3Rpb25EYXRhLmNhdGVnb3J5ID09PSAncG9rb2snKSB7CiAgICAgICAgbmV3QmFsYW5jZVBva29rICs9IGNoYW5nZTsKICAgICAgfQogICAgICAKICAgICAgLy8gQ2hlY2sgZm9yIHN1ZmZpY2llbnQgZnVuZHMgaWYgd2l0aGRyYXdhbAogICAgICBpZiAoIWlzRGVwb3NpdCkgewogICAgICAgIGlmICh0cmFuc2FjdGlvbkRhdGEuY2F0ZWdvcnkgPT09ICd3YWppYicgJiYgbmV3QmFsYW5jZVdhamliIDwgMCkgdGhyb3cgbmV3IEVycm9yKCdJbnN1ZmZpY2llbnQgV2FqaWIgYmFsYW5jZScpOwogICAgICAgIGlmICh0cmFuc2FjdGlvbkRhdGEuY2F0ZWdvcnkgPT09ICdzdWthcmVsYScgJiYgbmV3QmFsYW5jZVN1a2FyZWxhIDwgMCkgdGhyb3cgbmV3IEVycm9yKCdJbnN1ZmZpY2llbnQgU3VrYXJlbGEgYmFsYW5jZScpOwogICAgICAgIGlmICh0cmFuc2FjdGlvbkRhdGEuY2F0ZWdvcnkgPT09ICdwb2tvaycgJiYgbmV3QmFsYW5jZVBva29rIDwgMCkgdGhyb3cgbmV3IEVycm9yKCdJbnN1ZmZpY2llbnQgUG9rb2sgYmFsYW5jZScpOwogICAgICB9CiAgICAgIAogICAgICAvLyAzLiBVcGRhdGUgYWNjb3VudAogICAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7CiAgICAgICAgYmFsYW5jZVdhamliOiBuZXdCYWxhbmNlV2FqaWIsCiAgICAgICAgYmFsYW5jZVN1a2FyZWxhOiBuZXdCYWxhbmNlU3VrYXJlbGEsCiAgICAgICAgYmFsYW5jZVBva29rOiBuZXdCYWxhbmNlUG9rb2ssCiAgICAgICAgdXBkYXRlZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSwKICAgICAgfTsKCiAgICAgIC8vIFVwZGF0ZSBsYXN0V2FqaWJQYXltZW50IGlmIHRoaXMgaXMgYSBXYWppYiBkZXBvc2l0CiAgICAgIGlmIChpc0RlcG9zaXQgJiYgdHJhbnNhY3Rpb25EYXRhLmNhdGVnb3J5ID09PSAnd2FqaWInKSB7CiAgICAgICAgdXBkYXRlRGF0YS5sYXN0V2FqaWJQYXltZW50ID0gc2VydmVyVGltZXN0YW1wKCk7CiAgICAgIH0KCiAgICAgIHRyYW5zYWN0aW9uLnVwZGF0ZShhY2NvdW50UmVmLCB1cGRhdGVEYXRhKTsKICAgICAgCiAgICAgIC8vIDQuIENyZWF0ZSB0cmFuc2FjdGlvbiByZWNvcmQKICAgICAgY29uc3QgdHJhbnNhY3Rpb25SZWYgPSBkb2MoY29sbGVjdGlvbihkYiwgVFJBTlNBQ1RJT05TX0NPTExFQ1RJT04pKTsKICAgICAgdHJhbnNhY3Rpb24uc2V0KHRyYW5zYWN0aW9uUmVmLCB7CiAgICAgICAgLi4udHJhbnNhY3Rpb25EYXRhLAogICAgICAgIHNhdmluZ3NBY2NvdW50SWQ6IGFjY291bnRSZWYuaWQsCiAgICAgICAgY3VzdG9tZXJJZCwKICAgICAgICBhbW91bnQsCiAgICAgICAgZGF0ZTogc2VydmVyVGltZXN0YW1wKCksCiAgICAgIH0pOwogICAgfSk7CiAgfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcigiVHJhbnNhY3Rpb24gZmFpbGVkOiAiLCBlKTsKICAgIHRocm93IGU7CiAgfQp9OwoKZXhwb3J0IGNvbnN0IGdldFRyYW5zYWN0aW9ucyA9IGFzeW5jIChjdXN0b21lcklkOiBzdHJpbmcpOiBQcm9taXNlPFNhdmluZ3NUcmFuc2FjdGlvbltdPiA9PiB7CiAgY29uc3QgcSA9IHF1ZXJ5KAogICAgY29sbGVjdGlvbihkYiwgVFJBTlNBQ1RJT05TX0NPTExFQ1RJT04pLCAKICAgIHdoZXJlKCdjdXN0b21lcklkJywgJz09JywgY3VzdG9tZXJJZCksCiAgICBvcmRlckJ5KCdkYXRlJywgJ2Rlc2MnKQogICk7CiAgCiAgY29uc3QgcXVlcnlTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSk7CiAgCiAgcmV0dXJuIHF1ZXJ5U25hcHNob3QuZG9jcy5tYXAoZG9jID0+IHsKICAgIGNvbnN0IGRhdGEgPSBkb2MuZGF0YSgpOwogICAgcmV0dXJuIHsKICAgICAgaWQ6IGRvYy5pZCwKICAgICAgLi4uZGF0YSwKICAgICAgZGF0ZTogZGF0YS5kYXRlPy50b0RhdGUoKSwKICAgIH0gYXMgU2F2aW5nc1RyYW5zYWN0aW9uOwogIH0pOwp9Owo="}